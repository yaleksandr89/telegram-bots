# Telegram Bots

### UPD

* [12.07.2023] - Удален бот, который использовал бесконечный цикл

## Установка

```
Используемый стек:
* PHP ^8.0
* Composer ^2.0
```

1. Зарегистрировать бота в телеграмме и получить токен.
2. Переименовать `config.php.example` в `config.php` и заполнить константу токен (см. комментарии в файле)
3. Установить composer пакеты: `composer i`
4. После размещения бота на хостинге необходимо его привязать (`setWebhook`). 
   * Пример: если бот доступен по url `https://example.com/bot`, привязать его можно выполнив запрос: `https://api.telegram.org/bot{BOT_TOKEN}/setWebhook?url=https://example.com/bot` (наличие ssl - **обязательно**).
   * Проверить статус бота можно, выполнив запрос: `https://api.telegram.org/bot{BOT_TOKEN}/getWebhook`

## Реализованные боты

### simple-bot

Реализован "эхо" функционал, то есть отвечает вам сообщением, который вы написали. Также реализован функционал отправки
случайного изображения - если боту написать `photo`/ Пришлет случайное изображение из директории `simple-bot/img`
(файлы можно заменить своими).

>  [Пример работающего SimpleForStudyBot бота](https://t.me/SimpleForStudyBot "Пример работающего SimpleForStudyBot бота")

### tba-php-sdk

В данном боте помимо эхо функционала реализованно:

**Команды**:

* `/photo` - отправляется случайное изображение из директории `remote/tba-php-sdk/img` (файлы можно заменить своими).
* `/document` - отправляется случайное документ из директории `remote/tba-php-sdk/docs` (файлы можно заменить своими).
* `/video` - отправляется случайное видео из директории `remote/tba-php-sdk/videos` (файлы можно заменить своими).
* `/sticker` - Отправляет случайный стикер из массива `$arrIdStickers` (массив находится в `remote/tba-php-sdk/Utils/TelegramBotApiHelper`, 
можно добавить или заменить своими).
* `/start` - Вызывает простую клавиатуру в которой можно **отправить контакт** (работает на ПК и на смартфоне), 
**отправить свою локацию** (работает только на смартфоне). Реализован функционал перехода на другую клавиатуру и возврата к 
первой, а также возможность убрать клавиатуру (именно убрать, а не скрыть в значок).
* `/help` - вызывает встроенную клавиатуру, в которой реализовано переход по двум ссылкам. Также реализована 
"Функциональная кнопка" (в конкретном боте после её клика отрабатывает функция, которая изменяет текст и добавляет время клика).

**Остальной функционал**:

* При отправке любого стикера боту - вы получите его `ID`.
* При отправке `location:longitude,latitude` - бот ответит ссылкой на гугл карту (пример: `location:55.753220, 37.622513`).

>  [Пример работающего TbaPhpSdkBot бота](https://t.me/TbaPhpSdkBot "Пример работающего TbaPhpSdkBot бота")

### translation-bot-v1

Бот переводчик, перевод фраз осуществляется с помощью `dejurin/php-google-translate-for-free`. Доступные переводы:

* С Английского на Русский
* С Русского на английский

Есть возможность переводить как слова, так и словосочетания и предложения. Реализована обработка ошибок, если в бот отправить 
фото, видео, стикер или какой-то документ, пользователю вернется сообщение, что бот работает только с текстом.

>  [Пример работающего ya_translation_bot бота](https://t.me/ya_translation_bot "Пример работающего ya_translation_bot бота")

---

### Для отладки в ботах реализован функционал записи в логи

* Возникающие исключения отлавливаются в `try/catch` и пишутся в файл `try_catch_logs.txt`, который находится в папке с ботом.
* Для записи ответов с телеграмм бота и запросов с вашей стороны реализован методы `addToLogs()` / `writeToLogs()`.
