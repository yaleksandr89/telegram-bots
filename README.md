# Telegram Bots

Различные варианты реализации телеграм ботов. Есть вариант для локального использования (реализованно с помощью 
`getUpdates` и бесконечного цикла). А также боты для удаленного использования (реализованно с помощью `webhook`, 
требуется наличие https протокола).

Бот `simple-bot` для локального использования, а также `echo bot` для удаленного - самописные и из готовых решений для них 
используется `Guzzle, PHP HTTP client`.

## Структура

* `local` - Бот для локального использования
  * `simple-bot`- самописный бот
* `remote` - Боты для удаленного использования
  * `echo-bot` - самописный бот
  * `tba-php-sdk` - бот реализованный с помощью пакета: **Telegram Bot API - PHP SDK**
* `composer.json` / `composer.lock` - загружает необходимые пакеты
* `config.php.example` - конфиг для ботов (**переименовать в config.php**)
* `index.php` - файл "заглушка"
* `README.md` - описание

## Установка

```
Необходимо:
* PHP ^8.0
* Composer ^2.0
```

1. Зарегистрировать бота в телеграмме и получить токен. Под локальные боты можно использовать один и тот же токен, но для удаленных, рекомендую, исходить из правила 1 бот = 1 токен (так как `getUpdates` и `webhook` одновременно работать не могут).
2. Переименовать `config.php.example` в `config.php` и заполнить константу токен (см. комментарии в файле)
3. Установить composer пакеты: `composer i`
4. Для запуска:
   * Локального бота достаточно перейти в директорию `local/simple-bot` и `php index.php`.
   * Ботов для удаленного использования, необходимо загрузить на хостинг (**необходимо наличие https схемы**). После этого с URL по которому будет доступен бот, необходимо привязать webhook (пример привязки: `https://api.telegram.org/bot{{YOUR_TOKEN }}/setWebhook?url={{ YOUR URL }}`)

### Для отладки в ботах реализован функционал записи в логи

* Возникающие исключения отлавливаются в try/catch и пишутся в файл `try_catch_logs.txt`, который находится в папке с ботом.
* Для записи ответов с телеграмма и запросов с вашей стороны в ботах реализован метод `addToLogs()` в самописных ботах и `writeToLogs()` в боте: `tba-php-sdk`.

## Функционал ботов

### local/simple-bot

`Не использовать на хостинге (используется бесконечный цикл)`

Реализован "эхо" функционал, то есть отвечает вам сообщением, который вы написали. Также реализован функционал отправки
случайного изображения - если боту написать `photo` - он пришлет случайное изображение из директории `local/second-telegram-bot/img`
(файлы можно заменить своими).

### remote/echo-bot

Отличается от `local/second-telegram-bot` только методом получения данных с телеграмма - в этом боте используется webhook, то есть для
локального использования не подходит.

>  [Пример работающего SimpleForStudyBot бота](https://t.me/SimpleForStudyBot "Пример работающего SimpleForStudyBot бота")

### remote/tba-php-sdk

В данном боте помимо эхо функционала реализованно:

**Команды**:

* `/photo` - отправляется случайное изображение из директории `remote/tba-php-sdk/img` (файлы можно заменить своими).
* `/document` - отправляется случайное документ из директории `remote/tba-php-sdk/docs` (файлы можно заменить своими).
* `/video` - отправляется случайное видео из директории `remote/tba-php-sdk/videos` (файлы можно заменить своими).
* `/sticker` - Отправляет случайный стикер из массива `$arrIdStickers` (массив находится в `remote/tba-php-sdk/Utils/TelegramBotApiHelper`, 
можно добавить или заменить своими).
* `/start` - Вызывает простую клавиатуру в которой можно **отправить контакт** (работает на ПК и на смартфоне), 
**отправить свою локацию** (работает только на смартфоне). Реализован функционал перехода на другую клавиатуру и возврата к 
первой, а также возможность убрать клавиатуру (именно убрать, а не скрыть в значок).
* `/help` - вызывает встроенную клавиатуру, в которой реализовано переход по двум ссылкам. Также реализована 
"Функциональная кнопка" (в конкретном боте после её клика отрабатывает функция, которая изменяет текст и добавляет время клика).

**Остальной функционал**:

* При отправке любого стикера боту - вы получите его `ID`.
* При отправке `location:longitude,latitude` - бот ответит ссылкой на гугл карту (пример: `location:55.753220, 37.622513`).

>  [Пример работающего TbaPhpSdkBot бота](https://t.me/TbaPhpSdkBot "Пример работающего TbaPhpSdkBot бота")
